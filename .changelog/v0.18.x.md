# Release v0.18.x - Changelog

Released: YYYY-MM-DD

## Overview

Continued reliability improvements and codebase hardening.

## Improvements

### Guard remaining unprotected JSON.parse calls (S7 complete)
- Replaced bare `JSON.parse` with `safeJSONParse` in 7 more files (8 call sites): `agentContentGenerator.js`, `pm2Standardizer.js`, `automationScheduler.js`, `git.js` (2 locations), `aiDetect.js`, `memoryClassifier.js`, `clinvar.js`
- Continues the v0.17.8 effort that converted 5 services — all remaining unprotected JSON.parse calls on external/file data are now guarded
- Corrupted schedule files, malformed git log output, bad LLM responses, and damaged ClinVar index now gracefully return defaults or clear error messages instead of crashing the process

### Fix parseInt missing radix parameter (S10 complete)
- Added explicit radix (base 10) to all `parseInt()` calls across the codebase — prevents subtle bugs when parsing strings with leading zeros or unexpected prefixes
- Fixed 45+ call sites across 18 files: routes (notifications, detect, logs, genome, brain, scripts, cos, ports, agents, apps, history, memory), services (streamingDetect, digital-twin), client components (Apps, CreateApp, SchedulesTab, WorldTab, AIProviders, ConfigRow, ProductivityTab, DocumentsTab, OverviewTab), and tests

### Deduplicate consecutive identical decisions in CoS decision log
- Consecutive identical decisions (same type + reason) are now collapsed into a single entry with an incrementing `count` field — previously, repetitive idle/not_due entries every 60 seconds filled the 200-entry buffer within ~100 minutes, pushing out meaningful decisions
- UI shows repeat count (e.g., "142x") on collapsed entries so the user can still see how often a decision recurred
- Summary counts now reflect actual decision occurrences, not just collapsed entry count
- Meaningful decisions (task_selected, task_skipped, task_switched, rehabilitation) survive much longer in history since they're no longer evicted by noise

### Mark S8 and S9 as complete in PLAN.md
- S8 (cron parser iteration limit) was already implemented: `MAX_CRON_ITERATIONS`, `validateCronFieldRange()`, early null return
- S9 (validation boilerplate extraction) was already implemented: `validateRequest()` helper used across 80 call sites in 12 route files
