# Release v0.12.x - Changelog

Released: YYYY-MM-DD

## Overview

This release adds branch management and automated release workflow capabilities to the DevTools Git page.

## Features

### DevTools Git — Branch Update, Comparison & Release PR Workflow
- **Update Branches button**: One-click fetch and fast-forward merge of `dev` and `main` from origin, with automatic stash/restore if the working tree is dirty
- **Branch Comparison panel**: Shows how many commits `dev` is ahead of `main`, with commit list, diff stats (+insertions/-deletions/files changed), displayed as a "Release Status" card
- **Automated Release PR**: "Create Release PR" button triggers a full CoS agent task that pushes commits, updates the changelog, creates a PR from dev to main, iterates with Copilot review feedback (up to 3 rounds), verifies CI, and merges when approved
- **Release Confirmation dialog**: Modal listing the exact steps the agent will perform, preventing accidental releases
- **Push endpoint**: New server endpoint for pushing branches to origin, used by the release workflow

**Server changes**:
- `server/services/git.js` — Added `fetchOrigin`, `updateBranches`, `getBranchComparison`, `push` functions
- `server/routes/git.js` — Added `/update-branches`, `/branch-comparison`, `/push` POST endpoints

**Client changes**:
- `client/src/services/api.js` — Added `updateBranches`, `getBranchComparison`, `pushBranch` API functions
- `client/src/pages/DevTools.jsx` — Expanded GitPage with Update button, Release Status panel, release confirmation dialog, and CoS task integration

### CoS — Productivity & Streaks Dashboard
- **New Productivity Tab**: Added a "Streaks" tab to the Chief of Staff page that tracks work patterns and productivity metrics
- **Work Streaks**: Tracks consecutive days and weeks with completed tasks, displaying current and best streaks with visual emphasis
- **Hourly & Daily Patterns**: Analyzes which hours and days of the week have the highest success rates for tasks
- **AI Insights**: Generates recommendations like "Peak Performance Hour" and "Most Productive Day" based on historical patterns
- **Milestones**: Tracks achievements like "Completed 100 tasks" or "7-day work streak"
- **Gamification**: Flame icon for active streaks, trophy icons for milestones, encouraging consistent productivity

**Server changes**:
- `server/services/productivity.js` — New service with streak calculation, pattern analysis, and milestone tracking
- `server/routes/cos.js` — Added `/productivity`, `/productivity/summary`, `/productivity/recalculate` endpoints

**Client changes**:
- `client/src/components/cos/tabs/ProductivityTab.jsx` — Full-featured productivity dashboard with collapsible sections
- `client/src/components/cos/constants.js` — Added "Streaks" tab with Flame icon
- `client/src/services/api.js` — Added `getCosProductivity`, `getCosProductivitySummary`, `recalculateCosProductivity` functions

### Media → Security Page Rename
- **Renamed** the "Media" page to "Security" to better reflect its purpose as a remote security camera and microphone
- Updated route from `/media` to `/security`
- Added descriptive subtitle explaining the page turns the PortOS host into a remote webcam and audio monitor accessible over Tailscale from a phone

### DevTools Git — Generic Git Management for All Managed Apps
- **Auto-detect branches**: Server now detects `main`/`master` and `dev`/`develop` branches per-repo instead of hardcoding `dev`/`main`
- **Changelog detection**: `getGitInfo()` returns whether a `.changelog/` directory exists, enabling conditional changelog steps in release prompts
- **Generalized Update**: `updateBranches()` auto-detects which branches to update instead of hardcoded `['dev', 'main']`
- **Generalized Release PR**: `buildReleasePrompt()` now uses the app name, detected branch names, and conditionally includes changelog management based on repo structure
- **App filtering**: Archived apps are filtered out of the Git page dropdown
- **Dynamic UI**: Branch comparison label, release button visibility, release dialog steps, and toast messages all adapt to detected branch names

### CoS — Completed Agent Timestamps
- **Completed timestamp display**: Completed agent cards now show the date and time they finished (e.g., "Feb 8 3:30 PM") next to the duration, with full timestamp on hover

### Agents — Tools Tab with AI Content Generation & Autonomous Engagement
- **Tools tab**: New tab in the Agents page for interactive Moltbook content creation and engagement
- **AI post generation**: Generate Moltbook posts in an agent's unique voice using their personality profile, topics, and style
- **AI comment generation**: Generate contextual replies to posts with awareness of existing comments and agent history
- **Feed browser**: Browse and sort the Moltbook feed, or use AI-powered relevance scoring to find posts matching an agent's topics
- **Post & Comment composer**: Preview, edit, and publish AI-generated content with one-click publishing
- **Autonomous engage**: One-click "Engage Now" button that finds relevant posts, upvotes them, and generates/posts AI comments
- **History-aware prompts**: Content generation includes recent agent activity to avoid repetitive posts and comments
- **`engage` action type**: New scheduled action type for autonomous agent engagement (browsing + voting + commenting)
- **AI-powered action executor**: Post and comment scheduled actions now auto-generate content via AI when params are empty

**Server changes**:
- `server/services/agentContentGenerator.js` — New service with `generatePost`, `generateComment`, `generateReply`, and shared prompt-building helpers
- `server/services/agentFeedFilter.js` — New service with `scorePosts`, `findRelevantPosts`, `findReplyOpportunities` for topic-based feed filtering
- `server/routes/agentTools.js` — 10 new endpoints for content generation, publishing, feed browsing, and engagement
- `server/services/agentActionExecutor.js` — Enhanced with AI content generation fallback and new `engage` compound action
- `server/lib/validation.js` — Added tool schemas and `engage` action type

**Client changes**:
- `client/src/components/agents/tabs/ToolsTab.jsx` — Full-featured tools UI with feed browser, post/comment composers, drafts panel, and engage button
- `client/src/services/api.js` — Added 11 new API functions for agent tools plus 4 for draft management
- `client/src/components/agents/constants.js` — Added Tools tab and Engage action type

### Agents — Draft Persistence for Generated Content
- **Auto-save drafts**: AI-generated posts and comments are automatically saved as drafts, so content isn't lost when navigating away
- **Drafts panel**: New section in the Tools tab listing all saved drafts per agent, sorted by newest first
- **Load into composer**: Click a draft to load it back into the post or comment composer for further editing
- **Auto-delete on publish**: Drafts are automatically removed when their content is published to Moltbook
- **Manual delete**: Remove unwanted drafts with the delete button

**Server changes**:
- `server/services/agentDrafts.js` — New service for draft CRUD operations, persisting to `data/agents/drafts/{agentId}.json`
- `server/routes/agentTools.js` — Added GET/POST/PUT/DELETE draft endpoints
- `server/lib/validation.js` — Added `createDraftSchema` and `updateDraftSchema`

### Dashboard — Archived App Styling
- **Greyed-out cards**: Archived apps on the main dashboard now render with reduced opacity, dimmed icon/title colors, and a subtle "Archived" badge next to the app name
- **Sorted to bottom**: Archived apps are sorted after active apps in the grid so they don't intermix with actively managed services
- **Excluded from stats**: The Quick Stats cards (Total, Online, Stopped, Not Started) now count only active apps; the header shows an "(N archived)" count when archived apps exist

## Fixes

### Managed App Port Conflict — ENV Leak & Detection
- **Fix**: When PortOS started managed apps via `startFromEcosystem()`, the PortOS server's own `PORT=5554` env var leaked into child processes. Apps with `process.env.PORT || fallback` in their ecosystem configs would bind to 5554 instead of their intended port, crashing portos-server on restart.
- **Fix**: Port detection regex in `parseEcosystemConfig()` couldn't parse `process.env.PORT || 4420` expressions — it only captured `process.env.PORT` and failed to resolve it. Now extracts the `|| fallback` value.
- **Solution**: `startFromEcosystem()` now strips `PORT` and `HOST` from the inherited env before spawning PM2, and `resolvePortValue()` handles `expr || fallback` patterns

### Runner Config Access Crash
- **Fix**: `server/services/runner.js` was accessing `aiToolkitInstance.config.dataDir` and `aiToolkitInstance.config.hooks`, but the AI Toolkit object returned by `createAIToolkit()` has no `.config` property (config is internal to service closures). This caused a `TypeError: Cannot read properties of undefined (reading 'dataDir')` whenever the PortOS runner shim's `executeCliRun` was invoked.
- **Solution**: Pass `dataDir` and `hooks` explicitly to the runner shim via `setAIToolkit(toolkit, config)` and store them in a local `runnerConfig` variable

## Improvements

### CoS — Learning Health Summary on Dashboard
- **Learning stat card**: Added a 5th stat card to the CoS main page showing overall task learning success rate with visual health indicators
- **Quick access**: Clicking the Learning card navigates directly to the Learning tab for detailed analytics
- **Skipped task alerts**: Shows a warning count when task types have been auto-skipped due to poor performance (<30% success after 5+ attempts)
- **Status indicators**: Card border changes color based on health — purple for good, yellow for warning states, red for critical (skipped tasks)
- **Mobile support**: Learning summary displayed as a full-width card at the bottom of the mobile stats grid

**Server changes**:
- `server/services/taskLearning.js` — Added `getLearningSummary()` function returning lightweight health metrics (healthy/warning/critical/skipped counts, overall success rate)
- `server/routes/cos.js` — Added `/learning/summary` endpoint

**Client changes**:
- `client/src/services/api.js` — Added `getCosLearningSummary()` API function
- `client/src/pages/ChiefOfStaff.jsx` — Added learning summary state, fetches summary with page data, renders clickable Learning stat card in both desktop (5-column grid) and mobile layouts
