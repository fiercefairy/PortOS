# Release v0.10.x - Changelog Documentation System

Released: 2026-01-XX

## Overview

This release introduces a structured changelog documentation system for creating rich, detailed release notes. The system follows best practices from our other projects and integrates seamlessly with GitHub Actions to automatically create professional release descriptions.

## ðŸŽ‰ New Features

### Changelog Documentation System
- **Structured Release Notes**: Added `.changelog/` directory with `v{major}.{minor}.x.md` naming pattern
- **Comprehensive README**: Created detailed documentation for changelog format and best practices
- **GitHub Actions Integration**: Updated release workflow to automatically use changelog files with version substitution
- **Fallback Support**: Maintains automatic commit-based changelogs when manual changelog is not provided
- **Automatic File Rename**: Pattern files (e.g., `v0.10.x.md`) automatically renamed to versioned files (e.g., `v0.10.5.md`) on release, preserving git history

### Documentation Updates
- **CLAUDE.md Updates**: Added detailed release changelog process instructions
- **Best Practices Guide**: Documented when and how to create changelog files
- **Format Templates**: Provided clear structure with emoji-based sections for visual organization

### Chief of Staff - ETA Countdown
- **Agent ETA Display**: Running agents now show remaining time (e.g., "~2m 30s left") based on historical task completion times
- **Overtime Indicator**: When tasks exceed their typical duration, shows "+Xm Xs over estimate" in yellow with a pulse animation
- **Progress Bar Enhancement**: Improved progress bar with clearer "X% complete" and prominent ETA display
- **Visual Polish**: Slightly thicker progress bars and better typography for the countdown display

### Dashboard - Activity Streak
- **Current Streak Display**: Shows consecutive days of activity with dynamic emoji (fire for 7+ days, lightning for 3+, sparkles for less)
- **Longest Streak Tracking**: Displays your personal best streak alongside current streak
- **Personal Best Badge**: Green "Personal best!" badge appears when you match or beat your longest streak
- **7-Day Activity Bar**: Visual mini-chart showing activity for the past week with green/gray bars
- **Gamification**: Motivates consistent usage through streak tracking and progress visualization

### PortOS Stack Template - AI Provider Integration
- **AI Toolkit Integration**: New projects created with the PortOS Stack template now include `@portos/ai-toolkit` by default
- **Provider Management UI**: Scaffolded projects include an AI Providers page (`/providers`) for adding, editing, testing, and deleting providers
- **Navigation Integration**: New apps have icons in the sidebar with active state highlighting for Home, AI Providers, and About routes
- **Provider Management API**: `/api/providers` endpoints for managing AI providers (CLI or API-based)
- **Run Tracking**: `/api/runs` endpoints for executing and tracking AI runs
- **Prompt Templates**: `/api/prompts` endpoints for managing reusable prompt templates
- **Automatic Symlink**: Template creates symlinks to PortOS's ai-toolkit package in root, server, and client node_modules

### Create App Improvements
- **Default Directory Path**: The Create App page (`/apps/create`) now defaults to the PortOS parent directory
- **Folder Browser**: Added a folder picker button to browse and select project directories visually
- **Templates Auto-Default**: Templates page now automatically sets the target directory without requiring folder selection

### Digital Twin - Identity System
- **Digital Twin Documents**: New `/digital-twin` page for managing identity scaffold documents that define persona, values, and cognitive style
- **Document Management**: View, edit, create, and delete digital twin markdown documents organized by category (core, audio, behavioral, enrichment)
- **Multi-Model Behavioral Testing**: Run 14 behavioral alignment tests against multiple AI providers/models simultaneously with side-by-side comparison
- **Enrichment System**: Guided questionnaire across 14 categories (memories, favorites, values, routines, non-negotiables, decision heuristics, error intolerance, personality assessments, etc.) that generates document content from answers
- **Export Formats**: Export digital twin for use in external LLMs as System Prompt, CLAUDE.md, JSON, or individual files
- **CoS Integration**: Digital twin context automatically injected into Chief of Staff agent prompts when enabled
- **Identity Navigation Group**: Brain and Digital Twin now grouped under "Identity" section in navigation

### Digital Twin Enhancement: Reliable Identity Scaffolds
- **Completeness Validator**: New API endpoint and UI showing percentage of required identity sections covered (identity, values, communication, decision making, non-negotiables, error intolerance) with actionable suggestions for missing sections
- **Contradiction Detector**: AI-powered analysis to detect inconsistencies and conflicting statements across digital twin documents with severity levels and resolution suggestions
- **Dynamic Test Generation**: Generate behavioral tests automatically based on digital twin content - tests values in action, communication style, non-negotiables, and decision patterns
- **Writing Sample Analysis**: Paste writing samples to extract your authentic voice patterns (sentence structure, vocabulary, formality, tone) and automatically generate a WRITING_STYLE.md document
- **Creation Wizard**: 5-step guided wizard for new users covering identity basics, core values, communication style, decision making, and non-negotiables
- **Document Weighting**: Priority slider (1-10) on each document - higher weighted documents are preserved first when context limits force truncation
- **New Enrichment Categories**: Added non_negotiables, decision_heuristics, error_intolerance, and personality_assessments categories with 3 preset questions each
- **Best Practices Documentation**: Added DIGITAL_TWIN_GUIDE.md with comprehensive guidance on creating effective digital twin documents

### Digital Twin - Mobile Responsive Design
- **Mobile-First Layout**: Complete responsive redesign of the Digital Twin page and all tabs for mobile devices
- **Adaptive Document Editor**: Documents list and editor use stacked layout on mobile with back navigation
- **Touch-Friendly Controls**: All buttons and interactive elements have 40px+ minimum touch targets for accessibility
- **Responsive Grids**: Category grids, test provider selections, and export options adapt from multi-column to single-column on small screens
- **Horizontal Tab Scrolling**: Tab navigation scrolls horizontally on narrow screens with hidden scrollbar
- **Mobile-Optimized Forms**: Enrichment questionnaire, wizard, and all modals display properly on mobile with appropriate spacing

### Digital Twin - Personality Assessments
- **New Enrichment Category**: Added `personality_assessments` enrichment category for capturing Myers-Briggs, Big Five (OCEAN), Enneagram, DISC, StrengthsFinder, and other personality type results
- **Preset Questions**: Three guided questions covering MBTI type variations, Big Five trait scores, and other assessment results
- **PERSONALITY.md Target**: Answers enriched into a dedicated PERSONALITY.md core document
- **Support for Type Variance**: Questions acknowledge that people may test differently at different times (e.g., ENTJ/ENTP/INTJ/INTP for those near the middle on E/I and J/P dimensions)

### Digital Twin Rebranding
- **Soul â†’ Digital Twin**: Renamed the entire "Soul" feature to "Digital Twin" for clearer terminology
- **Route Changes**: `/soul` routes now at `/digital-twin`
- **API Endpoints**: `/api/soul` endpoints now at `/api/digital-twin`
- **Data Directory**: `data/soul/` renamed to `data/digital-twin/`
- **Backwards Compatibility**: Legacy function names and imports aliased for backwards compatibility

### Digital Twin - Quantitative Personality Modeling (M34 Phase 1 & 2)
- **Big Five Trait Extraction**: AI-powered analysis extracts OCEAN personality scores (0-1 scale) from digital twin documents with supporting evidence notes
- **Values Hierarchy**: Automatically extracts and ranks core values with conflict detection between values
- **Communication Profile**: Quantifies writing style including formality (1-10), verbosity (1-10), emoji usage, preferred tone, and distinctive markers
- **Confidence Scoring**: Calculates per-dimension confidence scores based on evidence quantity, specificity, and consistency
- **Gap Recommendations**: Identifies low-confidence dimensions and suggests specific enrichment questions to fill gaps
- **PersonalityMap Component**: New radar chart visualization showing Big Five traits with confidence-based coloring (green/yellow/red)
- **ConfidenceGauge Component**: Visual gauge showing overall twin confidence with dimension breakdown and trend indicators
- **GapRecommendations Component**: Prioritized list of suggested enrichments with urgency labels and specific questions
- **Prompt Templates**: New `twin-trait-extractor.md` and `twin-confidence-analyzer.md` prompt templates for AI-powered analysis
- **API Endpoints**: New `/api/digital-twin/traits`, `/api/digital-twin/traits/analyze`, `/api/digital-twin/confidence`, `/api/digital-twin/confidence/calculate`, and `/api/digital-twin/gaps` endpoints
- **Local Fallback**: Heuristic-based confidence calculation when AI provider is unavailable
- **Overview Tab Integration**: New components integrated into Digital Twin Overview tab for at-a-glance personality insights

### Digital Twin - External Data Integration (M34 Phase 4)
- **Import Tab**: New dedicated tab for importing personal data from external services
- **Goodreads CSV Import**: Parse Goodreads library exports to extract reading history, favorites, and shelf data for personality analysis
- **Spotify JSON Import**: Import Spotify extended streaming history and library data to capture music preferences and listening patterns
- **Letterboxd CSV Import**: Parse Letterboxd exports for film ratings, reviews, and watchlists
- **iCal Import**: Parse calendar files (.ics) to understand routines, priorities, and time allocation patterns
- **AI-Powered Analysis**: Uses `twin-import-analyzer.md` prompt template to extract personality insights from imported data
- **Document Generation**: Analyzed imports can be saved directly as digital twin documents with appropriate categorization
- **Provider Selection**: Choose AI provider/model for analysis with multi-tier support
- **Validation Schemas**: New Zod schemas for import sources and analysis results
- **API Endpoints**: New `/api/digital-twin/import/sources`, `/api/digital-twin/import/analyze`, and `/api/digital-twin/import/save` endpoints

### AI Provider Usage Limit Handling & Fallback
- **Usage Limit Detection**: Agents now detect provider usage limit errors (e.g., "You've hit your usage limit. Upgrade to Pro or try again in 1 day 1 hour 33 minutes") and mark providers as temporarily unavailable
- **Provider Status Tracking**: New `providerStatus.js` service tracks provider availability, usage limits, and estimated recovery times with persistence across server restarts
- **Automatic Fallback**: When a provider hits usage limits, tasks automatically use configured fallback providers - no manual intervention needed
- **Fallback Provider Configuration**: New "Fallback Provider" field in provider settings allows configuring which provider to use when the primary is unavailable
- **Task-Level Fallback Override**: Tasks can specify `metadata.fallbackProvider` to override provider-level and system defaults - gives fine-grained control per task type
- **Provider Status UI**: Health tab now shows provider availability status with real-time updates via WebSocket - displays unavailable providers, reason, and estimated recovery time
- **Manual Recovery**: "Recover" button allows manually marking a provider as available when you know the limit has reset
- **Socket.IO Events**: Real-time `provider:status:changed` events notify UI of provider status changes
- **API Endpoints**: New `/api/providers/status`, `/api/providers/:id/status`, and `/api/providers/:id/status/recover` endpoints for status management
- **AI Toolkit Integration**: Core rate limit detection, error categorization, and provider status tracking now built into `portos-ai-toolkit` v0.2.0 - PortOS wraps the toolkit service for backwards compatibility

### CoS Learning Data Reset
- **Reset Skipped Task Types**: Added ability to reset learning data for auto-paused task types that have been stuck due to historical failures (e.g., task types with 5% success after 200+ attempts from a now-fixed bug)
- **Clean Metric Subtraction**: Resetting a task type correctly subtracts its metrics from totals and cleans up associated error patterns, giving it a fresh start
- **UI Reset Button**: Each skipped task type in the Learning tab now shows a "Reset" button with toast notification feedback
- **API Endpoint**: New `POST /api/cos/learning/reset/:taskType` endpoint for programmatic access
- **Test Coverage**: 9 new unit tests covering reset logic, metric subtraction, error pattern cleanup, and edge cases

### CoS Auto-Rehabilitation for Skipped Task Types
- **Automatic Retry of Fixed Tasks**: Task types that were auto-paused due to poor performance (<30% success rate after 5+ attempts) are now automatically given a fresh chance after a configurable grace period (default: 7 days)
- **Grace Period Configuration**: New `rehabilitationGracePeriodDays` config option allows tuning how long skipped tasks wait before being retried
- **Periodic Rehabilitation Check**: During task evaluation, CoS checks every ~100 evaluations (~2 hours) for task types eligible for rehabilitation
- **Learning Data Reset**: When a task type is rehabilitated, its historical learning data is reset, giving it a clean slate to prove the underlying issue was fixed
- **Status Visibility**: New `getSkippedTaskTypesWithStatus()` function provides detailed info about skipped tasks including days until rehabilitation eligibility

### CoS Task Prompt Enhancement
- **AI-Powered Prompt Enhancement**: New "Enhance with AI" checkbox in the Add Task form that uses AI to expand brief task descriptions into comprehensive, detailed prompts
- **Actionable Prompts**: Enhanced prompts include specific steps, relevant context, success criteria, and edge cases to watch for
- **Prompt Stage Configuration**: Enhancement now uses the `cos-task-enhance` prompt stage for provider/model selection - configure via Prompt Manager instead of hardcoded defaults
- **Visual Feedback**: Loading spinner and "Enhancing..." state during prompt processing, with clear success/error toasts
- **API Endpoint**: New `POST /api/cos/tasks/enhance` endpoint for programmatic access to prompt enhancement

## ðŸ”§ Improvements

### Prompt Manager UX
- **Alphabetical Sorting**: Stages and variables lists are now sorted alphabetically for easier navigation in large prompt collections

### Release Process
- **Rich Release Descriptions**: GitHub releases now support detailed, categorized changelogs
- **Flexible Workflow**: Developers can choose between detailed changelogs or auto-generated commit logs
- **Consistency**: Standardized release note format across all versions
- **Version Substitution**: Workflow automatically replaces version placeholders with actual release version
- **Git History Preservation**: Pattern files renamed using `git mv` to maintain full file history

### Developer Experience
- **Clear Guidelines**: Comprehensive documentation in `.changelog/README.md`
- **Easy Maintenance**: Simple process for creating and updating release notes
- **Tool Integration**: Instructions for using `gh` CLI to manage releases

## ðŸ› Fixes

### Media Page Debug Logs Cleanup
- **Removed Debug Console Logs**: Cleaned up 10 `console.log` statements from `client/src/pages/Media.jsx` that were left over from AudioContext debugging - improves production code quality

### CoS Agent Provider/Model Validation
- **Provider Override Support**: Tasks specifying a `provider` in metadata now correctly use that provider instead of always using the active provider
- **Model Compatibility Validation**: When spawning agents, models are now validated against the target provider's model list - prevents invalid combinations like using Claude models with the Codex CLI provider
- **Graceful Fallback**: Invalid model/provider combinations fall back to the appropriate tier model for the actual provider with a warning log

### CoS Learning-Based Model Selection
- **Adaptive Model Upgrades**: Model selection now consults historical task performance data - task types with <60% success rate are automatically upgraded to heavier models (Opus)
- **Smarter Resource Allocation**: CoS learns from past failures and allocates more capable models to struggling task types, improving overall success rates
- **Transparent Logging**: Model selection logs now include learning-based reasons (e.g., "learning-suggested - task type has 45% success rate")

### System Task Deletion
- **Task Type Detection**: Deleting system tasks (prefixed with `sys-`) now correctly passes `type=internal` to the API, fixing "Task not found" errors when deleting auto-generated investigation tasks

## ðŸ—‘ï¸ Removed

### Dead Code Cleanup
- **Legacy Service Files**: Removed three unused `.old.js` files from `server/services/`:
  - `providers.old.js` - superseded by current `providers.js`
  - `promptService.old.js` - superseded by current `promptService.js`
  - `runner.old.js` - superseded by AI Toolkit's runner service
- These files were unreferenced throughout the codebase and represented ~1,220 lines of dead code

### DRY Refactoring: Shared File Utilities
- **New `server/lib/fileUtils.js`**: Created shared utility module for directory and path operations
  - `ensureDir(path)` - Ensures directory exists, creating recursively if needed
  - `ensureDirs(paths)` - Ensures multiple directories exist
  - `dataPath(...segments)` - Get path relative to data directory
  - `rootPath(...segments)` - Get path relative to project root
  - `PATHS` - Centralized path constants (data, cos, brain, digitalTwin, runs, memory, agents, scripts, reports)
- **Reduced Code Duplication**: Refactored 4 services (`apps.js`, `history.js`, `usage.js`, `notifications.js`) to use shared utility, eliminating identical `ensureDir` implementations and reducing boilerplate
- **Pattern for Future Refactoring**: Establishes pattern for remaining 7+ services with similar duplicated directory logic

### Chief of Staff - Navigation Improvements
- **Sidebar Sub-Navigation**: Chief of Staff sub-pages (Tasks, Agents, Scripts, Schedule, Digest, Learning, Memory, Health, Config) now appear as children in the sidebar navigation under Chief of Staff, making all tabs accessible without scrolling the page
- **Collapsible Agent Panel**: On mobile, the COS Agent avatar panel is now collapsible with a tap toggle header showing state and running status
- **Touch-Friendly Tabs**: Tab navigation buttons have 40px minimum height for better mobile accessibility
- **Scrollable Tab Bar**: Tab bar uses horizontal scroll with `shrink-0` to prevent tab overflow issues
- **Badge Support on Collapsible Sections**: Notification badges now display correctly on collapsible nav sections (both collapsed and expanded states)

## ðŸ› Bug Fixes

### Task Enhancer Directory Not Found Error
- **Fixed ENOENT error in task prompt enhancement**: The `taskEnhancer.js` was creating its own runId (`enhance-xxx`) and passing it to `createRun`, but the AI Toolkit's `createRun` ignores passed IDs and generates UUIDs. When `executeApiRun` was then called with the original `enhance-xxx` ID, the directory didn't exist.
- **Solution**: Now uses the `runId` returned from `createRun({ ... })` instead of generating a separate ID

### Fixed Multi-Line Context Loss in Agent Resume
- **Root Cause**: When resuming agent tasks, the "Additional Instructions" and "Previous Agent Context" provided in the resume form were truncated to just the first line (e.g., only "## Additional Instructions" was saved)
- **The Fix**: Task metadata values containing newlines are now properly escaped (`\n` â†’ `\\n`) when saving to the TASKS.md file and unescaped when parsing back
- **Impact**: Resume context now correctly passes full multi-line instructions to agents, including previous agent output, error context, and user refinements
- **Test Coverage**: Added new round-trip test to verify multi-line metadata preservation through save/parse cycle

### Brain Memory Delete Handler
- **Fixed Delete Success Detection**: The MemoryTab delete handler was checking `result !== null` to determine success, but successful API responses might not return a value. Changed to track failures explicitly with a boolean flag, fixing false-positive "Deleted" toasts when delete operations failed

### Setup Script pm2 Command Not Found
- **Fixed post-setup pm2 availability**: After running `./setup.sh`, users would get "zsh: command not found: pm2" because pm2 is installed locally in `server/node_modules`, not globally
- **Added npm scripts**: New `npm run pm2:start`, `npm run pm2:stop`, and `npm run pm2:logs` scripts that use `npx` to run the local pm2
- **Updated documentation**: Setup script output and CLAUDE.md now reference the npm scripts instead of direct pm2 commands

### Critical: Fixed "Unexpected end of JSON input" Errors
- **Safe JSON Parsing**: Added comprehensive JSON parsing utilities to `server/lib/fileUtils.js`:
  - `isValidJSON(str)` - Pre-validates JSON structure before parsing (supports both objects and arrays)
  - `safeJSONParse(str, defaultValue)` - Safely parses JSON with fallback on empty/corrupted content
  - `readJSONFile(filePath, defaultValue)` - Combines file reading with safe JSON parsing
  - `safeJSONLParse(content)` - Safely parses JSONL files, skipping malformed lines
  - `readJSONLFile(filePath)` - Reads and parses JSONL files safely
- **Fixed 15+ Services**: Applied safe JSON parsing to all file-reading operations across:
  - `history.js`, `memory.js`, `notifications.js`, `usage.js`
  - `weeklyDigest.js`, `taskLearning.js`, `appActivity.js`, `taskSchedule.js`
  - `brainStorage.js`, `subAgentSpawner.js`, `digital-twin.js`, `streamingDetect.js`
  - `routes/scaffold.js`, `routes/detect.js`
- **Root Cause**: Empty or corrupted JSON files would cause `JSON.parse()` to throw "Unexpected end of JSON input", crashing services. Now all JSON file reads use safe parsing with sensible defaults

## ðŸ“¦ Installation

```bash
git clone https://github.com/atomantic/PortOS.git
cd PortOS
npm run install:all
npm run pm2:start
```

## ðŸ”— Full Changelog

**Full Diff**: https://github.com/atomantic/PortOS/compare/v0.9.9...v0.10.x
