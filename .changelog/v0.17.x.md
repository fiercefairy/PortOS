# Release v0.17.x - Changelog

Released: YYYY-MM-DD

## Overview

JIRA integration improvements and token lifecycle management.

## Features

### JIRA token expiry tracking and warning
- **Tracks `tokenUpdatedAt`** on each instance when a PAT is saved, separate from `updatedAt` which changes on any edit
- **Client shows expiry warnings** based on 30-day PAT lifetime: yellow warning at 5 days remaining, red alert when expired
- **Handles legacy instances** without `tokenUpdatedAt` gracefully — prompts user to re-save to start tracking

### JIRA ticket transitions, deletion, and update CLI
- **`jira-update-ticket.js` CLI** — update fields, add comments, transition status, or delete tickets from the command line
- **`--transition "Done"`** moves a ticket to any status by name (or numeric ID); `--transitions` lists available transitions
- **`--delete`** deletes a ticket directly from the CLI
- **`getTransitions()` and `deleteTicket()`** added to the JIRA service and routes for programmatic use

### CoS agent git isolation for managed apps
- **Managed app tasks always get an isolated worktree** based on the latest `origin/main` (or `origin/master`) — prevents cross-agent contamination from dirty state, stale branches, or other agents' uncommitted changes
- **Worktrees now fetch + base off the remote default branch** instead of whatever `HEAD` happens to be locally — agents start from a known-clean state
- **JIRA feature branches** also start from the latest default branch when working on managed apps
- **Agent prompt includes explicit git hygiene rules** — verify clean working tree before starting, stage only specific files (never `git add .`), and refuse to commit or PR unrelated changes

## Improvements

### CityHud scan line: CSS animation instead of setInterval
- Replaced 50ms `setInterval` (20 React re-renders/sec) with a pure CSS `@keyframes` animation
- Eliminates unnecessary React state updates and re-renders for a visual-only effect

### Convert sync file I/O to async in server route handlers
- `attachments.js` GET /: replaced `readdirSync` + `statSync` loop with async `readdir` + `Promise.all(stat)`
- `detect.js` POST /repo: replaced `statSync` with async `stat`
- `visionTest.js` runVisionTestSuite: replaced `readdirSync` with async `readdir`
- Prevents event loop blocking when listing large directories

### Replace raw JSON.parse with safeJSONParse in 5 services
- `platformAccounts.js`, `agentPersonalities.js`, `cosEvolution.js`, `missions.js`, `agentDrafts.js`
- Corrupted JSON files now gracefully fall back to defaults instead of crashing the process
